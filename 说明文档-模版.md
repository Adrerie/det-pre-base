# 课题《基于时间序列模型的作物病虫害预警模型构建》

- **作者**：李想
- **单位**：南京农业大学

**模型实际应用效果**：
本模型旨在构建一个高效、精准的作物病虫害检测与预警系统。前端检测模型（Pest-AdapNet）能够实时、准确地从田间图像中识别多种害虫，并输出其类别、位置和置信度。这些结构化的检测数据将作为时间序列数据源，输入到后续的预警模型中。通过分析害虫数量随时间的变化趋势，预警模型能够预测未来病虫害的爆发风险，为精准农业管理和及时干预提供决策支持，从而减少农药使用，降低经济损失。

---

## 一、基本信息
- **模型算法名称**：Pest-AdapNet
- **名称含义**：Pest-AdapNet (Pest Adaptive Network) 是一个为应对复杂农业环境下害虫检测挑战而设计的自适应网络。
  - **Pest**: 明确点明模型的核心应用领域——农业“害虫”检测。
  - **AdapNet** (Adaptive Network): “自适应网络”是模型设计的核心思想。它完美地概括了模型为解决实际难题所做的努力：
    - **CSAB模块中的可变形采样**实现了对害虫不同形态和姿态的**空间自适应**。
    - **DBL损失函数**实现了对数据集中类别不平衡和小目标问题的**训练自适应**。
    - 整个框架的核心就是“为适应（Adapt）复杂挑战而生”，因此得名 AdapNet。
  - **核心模块详解**:
    - **ECA** (Efficient Channel Attention)：高效通道注意力模块，用于增强模型对关键特征通道的关注度。
    - **CSAB** (Channel-Spatial Attention Block)：通道-空间注意力模块，结合了可变形采样（Deformable Sampling），增强了对不同尺度和形态目标的适应性。
    - **DBL** (Dynamic Balanced Loss)：动态平衡损失函数。这是一个复合损失函数，专门为农业场景中的小目标和类别不平衡问题设计。它包含三个关键部分：
        1.  **动态类别平衡**: 通过计算每个批次中各类别的出现频率，动态地为稀有类别分配更高的损失权重，有效缓解了长尾分布问题。
        2.  **尺度感知框回归**: 借鉴 TSD (Task-Shared Detection) 思想，在计算边界框损失时，为面积较小的目标（如早期幼虫）赋予更大的权重，迫使模型更加关注小目标的定位精度。
        3.  **截断式 IoU 损失**: 对预测框与真实框交并比（IoU）较低的情况施加额外惩罚，特别是当 IoU 低于预设阈值时，能更快地优化模型，使其生成的边界框更准确。
- **开发目的**：开发一个轻量级、高性能的作物病虫害目标检测模型。该模型是整个预警系统的数据采集前端，其核心任务是为后续的时间序列分析和爆发预警提供高质量、高精度的害虫时序数据。
- **核心算法类型**：深度学习、目标检测（Object Detection）。
- **输入（API使用时）**：单张图像或图像序列（视频流）。API 格式通常为图像文件（如 JPEG, PNG）或 Base64 编码的字符串。
- **输出（API使用时）**：一个包含多个检测结果的 JSON 列表。每个结果包含：
  - `bounding_box`: 目标边界框 `[x_center, y_center, width, height]`。
  - `class_id`: 害虫类别标签。
  - `confidence`: 检测结果的置信度得分。
- **模型参数量/层数**：模型基于轻量级的 `yolo11n` 构建，并通过注入 ECA 和 CSAB 模块进行了增强。虽然参数量略有增加，但整体上仍保持在一个较低的水平，以确保移动端或边缘设备的部署可行性。
- **预训练模型**：`yolo11n.pt`。
- **可解释性模块**：模型中集成的 **ECA** 和 **CSAB** 注意力模块具备一定的可解释性。通过可视化这些模块的注意力图，可以分析模型在进行决策时重点关注了图像的哪些通道和空间区域，有助于理解模型的决策依据。

---

## 二、适用场景
- **针对用户**：农业技术人员、植保专家、智慧农业系统集成商。
- **使用方式**：可部署在云端服务器，通过 API 接收图像进行分析；或部署在田间的边缘计算设备（如 Jetson Nano）上，连接摄像头进行实时监测。
- **适用条件**：适用于光照条件良好、图像清晰度较高的场景。对于夜间或恶劣天气，可能需要补光设备或特定的图像增强算法。
- **硬件需求**：
  - **训练**：需要配备高性能 NVIDIA GPU（如 RTX 30系列/40系列，显存 > 8GB）的服务器或工作站。
  - **推理**：
    - **云端**: 标准的 CPU 或 GPU 服务器均可。
    - **边缘端**: 支持 CUDA 的 NVIDIA Jetson 系列设备，或支持其他加速框架的边缘计算盒。
- **实时性**：在合适的硬件上可以达到实时检测要求（>30 FPS），满足视频流监控的需求。

---

## 三、数据情况
- **训练数据规模**：基于 Pest24 数据集，包含24种农业害虫，拥有数万个标注实例。
- **数据来源**：公开农业数据集或田间实地采集。
- **数据详情**：
  - **采集**：通过固定摄像头、无人机或手持设备在不同作物生长周期和田间环境下拍摄。
  - **传感器**：高分辨率 CMOS 图像传感器。
  - **数据类型**：RGB 图像。
  - **类别标签**：包含蚜虫、蝗虫、黏虫等24种常见害虫。
- **性能评估**：使用标准的 PASCAL VOC 指标进行评估，主要关注 mAP@0.5 和 mAP@0.5:0.95。
- **标注方式**：使用 LabelImg 等工具进行手动边界框标注。
- **数据处理策略**：应用了包括 Mosaic、MixUp 在内的多种数据增强策略，以提升模型的泛化能力。
- **数据与模型版本绑定**：当前模型版本（Pest-AdapNet v1.0）是基于 Pest24 数据集训练的，推荐使用此数据集或类似分布的数据进行推理。
- **跨域泛化能力**：通过丰富的数据增强和先进的模块设计，模型对不同光照、背景和拍摄角度具有一定的泛化能力，但在全新环境（如不同作物背景）下使用时，建议进行少量样本的微调（Fine-tuning）。

---

## 四、算法先进程度
- **对比基线**：原始的 `YOLOv11-nano` 模型。Pest-AdapNet 在此基础上，通过引入三大核心模块，在 mAP 等关键指标上实现了显著提升，尤其在小目标检测和复杂背景下的鲁棒性更强。
- **对标模型**：与当前其他主流的轻量级检测模型（如 YOLOv7-tiny, YOLOv8-n, MobileNet-SSD）进行性能对比。
- **相关模型**：
  - **ECA-Net**: 引入了高效通道注意力的思想。
  - **CBAM**: 本模型的 CSAB 模块借鉴了其通道与空间分离注意力的思路。
  - **Deformable Convolutional Networks**: CSAB 模块中的可变形采样借鉴了其核心思想，但实现方式更为轻量。
  - **TSD (Task-Shared Detection)**: DBL 损失函数借鉴了其针对小目标的尺度感知加权思想。

---

## 五、部署与工程化
- **接口协议**：提供基于 HTTP/HTTPS 的 RESTful API 接口，支持 JSON 格式的输入和输出。
- **依赖环境**：
  - Python 3.8+
  - PyTorch 1.10+
  - Ultralytics 8.0+
  - OpenCV-Python
- **容器化支持**：暂不提供容器化部署方案，但项目提供了 `requirements.txt` 文件。用户可以通过该文件，使用 `pip install -r requirements.txt` 命令快速构建与开发环境一致的 Python 虚拟环境，从而保证了环境的可复现性。
- **再训练频率**：建议根据应用场景的季节性变化或环境变化，每季度或每半年使用新采集的数据对模型进行一次增量训练或微调，以维持最优性能。

---

## 六、算法归类
- **作物对象**：通用（当前数据集主要为多种作物背景下的害虫）。
- **农事环节**：生长监测、病虫害防治。
- **算法维度**：图像识别、目标检测、智能感知。
